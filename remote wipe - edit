<#
.SYNOPSIS
   Windows - Security - Remote Wipe

.WARNING
    The Remote Wipe Worklet is a powerful tool that can result in the permanent loss of data.
   Please ensure that the Worklet is used only in appropriate circumstances and with appropriate safeguards in place to prevent any permanent loss of data.

.PREREQUISITES
   Powershell v5+

.DESCRIPTION
   This Worklet will completely wipe a Windows device and restore it to its factory state.
   There is no recovery or returning from the execution of this Worklet.
   All data stored on the device will be lost.
   It works by utilizing the doWipeMethod method from the MDM_RemoteWipe class: https://learn.microsoft.com/en-us/windows/win32/dmwmibridgeprov/mdm-remotewipe
   Once the Worklet is executed, the device will immediately reboot and run through the "Resetting this PC" OOBE process.

.EXAMPLE

.USAGE
   Due to the impact of this Worklet, it should NOT be used with a schedule and instead, ran manually against a target device.
   To further reduce inadvertent impact, it is recommended that this Worklet be associated to its own Group, and Devices should be added manually to the Group as needed.
   Automox Install and Reboot Notifications should be turned off in the policy.

.NOTES
   Author: John Guarracino
   Date: May 2, 2023
#>

$namespaceName = "root\cimv2\mdm\dmmap"
$className = "MDM_RemoteWipe"
$methodName = "doWipeMethod"

$session = New-CimSession

$params = New-Object Microsoft.Management.Infrastructure.CimMethodParametersCollection
$param = [Microsoft.Management.Infrastructure.CimMethodParameter]::Create("param", "", "String", "In")
$params.Add($param)

try
{
    $instance = Get-CimInstance -Namespace $namespaceName -ClassName $className -Filter "ParentID='./Vendor/MSFT' and InstanceID='RemoteWipe'"
    $session.InvokeMethod($namespaceName, $instance, $methodName, $params)
}
catch [Exception]
{
    Write-Output $_ | Out-String
}
